<!--pages/toolbox/simulator/index.wxml-->
<view class="page">
  <nav-bar title="æ–°å¹´æ¨¡æ‹Ÿå™¨" bgColor="#B71C1C" showBack="{{true}}"></nav-bar>

  <!-- æ¸¸æˆä¸»ç•Œé¢ -->
  <view class="game-container" wx:if="{{currentScript && !gameEnding}}">
    <!-- å‰§æœ¬ä¿¡æ¯å¡ç‰‡ -->
    <view class="script-info-card">
      <text class="script-icon">{{currentScript.icon}}</text>
      <view class="script-info">
        <text class="script-name">{{currentScript.name}}</text>
        <text class="script-desc">{{currentScript.desc}}</text>
      </view>
    </view>

    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <view class="status-bar">
      <view class="month-indicator">
        <text class="month-number">{{currentMonth}}</text>
        <text class="month-text">æœˆ</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{(currentMonth / 12) * 100}}%"></view>
      </view>
    </view>

    <!-- å±æ€§æ˜¾ç¤º -->
    <view class="stats-panel">
      <view class="stat-item" wx:for="{{statsList}}" wx:key="key">
        <text class="stat-icon">{{item.icon}}</text>
        <view class="stat-bar">
          <view class="stat-fill" style="width: {{item.value}}%; background: {{item.color}};"></view>
        </view>
        <text class="stat-value">{{item.value}}</text>
      </view>
    </view>

    <!-- äº‹ä»¶å¡ç‰‡ -->
    <view class="event-card" wx:if="{{currentEvent}}">
      <view class="event-header">
        <text class="event-month">{{currentMonth}}æœˆ</text>
        <text class="event-title">{{currentEvent.title}}</text>
      </view>

      <view class="event-content">
        <text class="event-text">{{currentEvent.content}}</text>
      </view>

      <!-- é€‰é¡¹åˆ—è¡¨ -->
      <view class="options-list">
        <view
          class="option-item"
          wx:for="{{currentEvent.options}}"
          wx:for-item="option"
          wx:key="index"
          bindtap="selectOption"
          data-index="{{index}}"
        >
          <view class="option-dot"></view>
          <text class="option-text">{{option.text}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»“å±€ç•Œé¢ -->
  <view class="ending-container" wx:if="{{gameEnding}}">
    <view class="ending-header">
      <text class="ending-icon">{{ending.icon}}</text>
      <text class="ending-title">{{ending.title}}</text>
    </view>

    <view class="ending-desc">
      <text>{{ending.desc}}</text>
    </view>

    <!-- æœ€ç»ˆå±æ€§ -->
    <view class="final-stats">
      <view class="final-stat-item" wx:for="{{statsList}}" wx:key="key">
        <text class="final-stat-icon">{{item.icon}}</text>
        <view class="final-stat-info">
          <text class="final-stat-label">{{item.label}}</text>
          <text class="final-stat-value">{{finalStats[item.key]}}</text>
        </view>
        <view class="final-stat-bar">
          <view class="final-stat-fill" style="width: {{finalStats[item.key]}}%; background: {{item.color}};"></view>
        </view>
      </view>
    </view>

    <!-- å¹´åº¦å›é¡¾ -->
    <view class="year-review">
      <view class="review-title">ğŸ“ 2026å¹´åº¦å›é¡¾</view>
      <view class="review-content">
        <view class="review-item" wx:for="{{reviewList}}" wx:key="index">
          <text class="review-month">{{item.month}}æœˆ</text>
          <text class="review-choice">{{item.choice}}</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="ending-actions">
      <button class="btn-restart" bindtap="restartGame">ğŸ”„ å†ç©ä¸€æ¬¡</button>
      <button class="btn-share" bindtap="shareResult" open-type="share">ğŸ“¤ åˆ†äº«æˆ˜ç»©</button>
    </view>
  </view>
</view>
