import{h as V}from"./request-BqCUV8Mx.js";import{d as we,j as Z,v as Pe,o as _,c as S,a as g,b as l,w as t,z as ee,l as I,y as Ce,i as m,r as n,A as he,h as p,t as q,F as ke,C as Te,q as Se,E as v,s as le}from"./index-Dh_mjgbh.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe=s=>V.get("/admin/gala/platforms",{params:s}),Ue=s=>V.post("/admin/gala/platforms",s),Fe=(s,c)=>V.put(`/admin/gala/platforms/${s}`,c),$e=s=>V.delete(`/admin/gala/platforms/${s}`),Ne=s=>V.get("/admin/gala/programs",{params:s}),Be=s=>V.post("/admin/gala/programs",s),ze=(s,c)=>V.put(`/admin/gala/programs/${s}`,c),je=s=>V.delete(`/admin/gala/programs/${s}`),y={adminGetPlatforms:xe,createPlatform:Ue,updatePlatform:Fe,deletePlatform:$e,adminGetPrograms:Ne,createProgram:Be,updateProgram:ze,deleteProgram:je},Me={class:"gala-list-page page-container"},Ye={key:0},Ee={class:"actions-bar"},Re={class:"card"},Ie={key:1},qe={class:"search-form"},Ge={class:"search-form-item"},He={key:0,class:"actions-bar"},Le={class:"card"},Oe=we({__name:"List",setup(s){const c=m("platforms"),P=m(!1),F=m([]),$=m([]),ae=Se(()=>F.value.filter(o=>o.reviewStatus==="approved")),w=m(null),C=m(!1),N=m("新建平台"),D=m(),B=m(!1),k=m(null),r=Z({name:"",year:new Date().getFullYear(),airDate:"",airTime:"",channel:"",logo:"",poster:"",description:"",sort:0,isShow:!0}),te={name:[{required:!0,message:"请输入平台名称",trigger:"blur"}],year:[{required:!0,message:"请输入年份",trigger:"blur"}]},h=m(!1),z=m("新建节目"),x=m(),j=m(!1),T=m(null),u=Z({title:"",type:"",performers:"",airTime:"",orderNum:0}),oe={title:[{required:!0,message:"请输入节目名称",trigger:"blur"}]},G={pending:"待审核",approved:"已通过",rejected:"已拒绝"},H={pending:"warning",approved:"success",rejected:"danger"},U=async()=>{P.value=!0;try{const o=await y.adminGetPlatforms({});F.value=o.list||[]}catch(o){console.error("加载平台失败:",o)}finally{P.value=!1}},M=async()=>{if(w.value){P.value=!0;try{const o=await y.adminGetPrograms({platformId:w.value});$.value=o.list||[]}catch(o){console.error("加载节目失败:",o)}finally{P.value=!1}}},re=()=>{c.value==="platforms"&&U()},ne=()=>{N.value="新建平台",k.value=null,Object.assign(r,{name:"",year:new Date().getFullYear(),airDate:"",airTime:"",channel:"",logo:"",poster:"",description:"",sort:0,isShow:!0}),C.value=!0},se=o=>{N.value="编辑平台",k.value=o.id,Object.assign(r,{name:o.name,year:o.year||new Date().getFullYear(),airDate:o.airDate||"",airTime:o.airTime||"",channel:o.channel||"",logo:o.logo||"",poster:o.poster||"",description:o.description||"",sort:o.sort||0,isShow:o.isShow!==void 0?o.isShow:!0}),C.value=!0},ie=async()=>{D.value&&await D.value.validate(async o=>{if(o){B.value=!0;try{k.value?(await y.updatePlatform(k.value,r),v.success("更新成功")):(await y.createPlatform(r),v.success("创建成功")),C.value=!1,U()}catch(e){v.error(e.message||"操作失败")}finally{B.value=!1}}})},ue=async o=>{try{await le.confirm(`确定要删除平台 "${o.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await y.deletePlatform(o.id),v.success("删除成功"),U()}catch{}},de=()=>{var o;(o=D.value)==null||o.resetFields(),k.value=null},me=()=>{if(!w.value){v.warning("请先选择平台");return}z.value="新建节目",T.value=null,Object.assign(u,{title:"",type:"",performers:"",airTime:"",orderNum:$.value.length+1}),h.value=!0},pe=o=>{z.value="编辑节目",T.value=o.id,Object.assign(u,{title:o.title,type:o.type||"",performers:o.performers||"",airTime:o.airTime||"",orderNum:o.orderNum||0}),h.value=!0},fe=async()=>{x.value&&await x.value.validate(async o=>{if(o){j.value=!0;try{T.value?(await y.updateProgram(T.value,u),v.success("更新成功")):(await y.createProgram({...u,platform_id:w.value}),v.success("创建成功")),h.value=!1,M()}catch(e){v.error(e.message||"操作失败")}finally{j.value=!1}}})},ge=async o=>{try{await le.confirm(`确定要删除节目 "${o.title}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await y.deleteProgram(o.id),v.success("删除成功"),M()}catch{}},ve=()=>{var o;(o=x.value)==null||o.resetFields(),T.value=null};return Pe(()=>{U()}),(o,e)=>{const L=n("el-tab-pane"),ce=n("el-tabs"),O=n("Plus"),A=n("el-icon"),f=n("el-button"),i=n("el-table-column"),Y=n("el-tag"),J=n("el-table"),be=n("el-option"),_e=n("el-select"),b=n("el-input"),d=n("el-form-item"),E=n("el-input-number"),ye=n("el-date-picker"),K=n("el-time-picker"),Ve=n("el-switch"),Q=n("el-form"),W=n("el-dialog"),X=he("loading");return _(),S("div",Me,[e[34]||(e[34]=g("h2",{class:"page-title"},"春晚管理",-1)),l(ce,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),onTabChange:re},{default:t(()=>[l(L,{label:"春晚平台",name:"platforms"},{label:t(()=>[...e[21]||(e[21]=[g("span",null,"春晚平台",-1)])]),_:1}),l(L,{label:"节目单",name:"programs"},{label:t(()=>[...e[22]||(e[22]=[g("span",null,"节目单",-1)])]),_:1})]),_:1},8,["modelValue"]),c.value==="platforms"?(_(),S("div",Ye,[g("div",Ee,[l(f,{type:"primary",onClick:ne},{default:t(()=>[l(A,null,{default:t(()=>[l(O)]),_:1}),e[23]||(e[23]=p(" 新建平台 ",-1))]),_:1})]),g("div",Re,[ee((_(),I(J,{data:F.value},{default:t(()=>[l(i,{prop:"name",label:"平台名称","min-width":"150"}),l(i,{prop:"year",label:"年份",width:"80"}),l(i,{prop:"airDate",label:"播出日期",width:"120"}),l(i,{prop:"airTime",label:"播出时间",width:"100"}),l(i,{prop:"channel",label:"播出频道",width:"150"}),l(i,{prop:"isShow",label:"显示",width:"80"},{default:t(({row:a})=>[l(Y,{type:a.isShow?"success":"info",size:"small"},{default:t(()=>[p(q(a.isShow?"显示":"隐藏"),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"reviewStatus",label:"审核状态",width:"100"},{default:t(({row:a})=>[l(Y,{type:H[a.reviewStatus],size:"small"},{default:t(()=>[p(q(G[a.reviewStatus]),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"sort",label:"排序",width:"80"}),l(i,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[l(f,{size:"small",onClick:R=>se(a)},{default:t(()=>[...e[24]||(e[24]=[p("编辑",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:R=>ue(a)},{default:t(()=>[...e[25]||(e[25]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,P.value]])])])):(_(),S("div",Ie,[g("div",qe,[g("div",Ge,[e[26]||(e[26]=g("label",null,"选择平台",-1)),l(_e,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=a=>w.value=a),placeholder:"请选择平台",onChange:M,style:{width:"200px"}},{default:t(()=>[(_(!0),S(ke,null,Te(ae.value,a=>(_(),I(be,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),w.value?(_(),S("div",He,[l(f,{type:"primary",onClick:me},{default:t(()=>[l(A,null,{default:t(()=>[l(O)]),_:1}),e[27]||(e[27]=p(" 新建节目 ",-1))]),_:1})])):Ce("",!0),g("div",Le,[ee((_(),I(J,{data:$.value},{default:t(()=>[l(i,{prop:"orderNum",label:"序号",width:"80"}),l(i,{prop:"title",label:"节目名称","min-width":"200"}),l(i,{prop:"type",label:"类型",width:"120"}),l(i,{prop:"performers",label:"表演者","min-width":"200","show-overflow-tooltip":""}),l(i,{prop:"airTime",label:"播出时间",width:"100"}),l(i,{prop:"reviewStatus",label:"审核状态",width:"100"},{default:t(({row:a})=>[l(Y,{type:H[a.reviewStatus],size:"small"},{default:t(()=>[p(q(G[a.reviewStatus]),1)]),_:2},1032,["type"])]),_:1}),l(i,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[l(f,{size:"small",onClick:R=>pe(a)},{default:t(()=>[...e[28]||(e[28]=[p("编辑",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:R=>ge(a)},{default:t(()=>[...e[29]||(e[29]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,P.value]])])])),l(W,{modelValue:C.value,"onUpdate:modelValue":e[13]||(e[13]=a=>C.value=a),title:N.value,width:"600px",onClosed:de},{footer:t(()=>[l(f,{onClick:e[12]||(e[12]=a=>C.value=!1)},{default:t(()=>[...e[30]||(e[30]=[p("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:ie,loading:B.value},{default:t(()=>[...e[31]||(e[31]=[p(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Q,{ref_key:"platformFormRef",ref:D,model:r,rules:te,"label-width":"100px"},{default:t(()=>[l(d,{label:"平台名称",prop:"name"},{default:t(()=>[l(b,{modelValue:r.name,"onUpdate:modelValue":e[2]||(e[2]=a=>r.name=a),placeholder:"如：央视春晚、河南春晚等"},null,8,["modelValue"])]),_:1}),l(d,{label:"年份",prop:"year"},{default:t(()=>[l(E,{modelValue:r.year,"onUpdate:modelValue":e[3]||(e[3]=a=>r.year=a),min:2e3,max:2100},null,8,["modelValue"])]),_:1}),l(d,{label:"播出日期"},{default:t(()=>[l(ye,{modelValue:r.airDate,"onUpdate:modelValue":e[4]||(e[4]=a=>r.airDate=a),type:"date",placeholder:"选择播出日期",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(d,{label:"播出时间"},{default:t(()=>[l(K,{modelValue:r.airTime,"onUpdate:modelValue":e[5]||(e[5]=a=>r.airTime=a),placeholder:"选择播出时间",style:{width:"100%"},"value-format":"HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(d,{label:"播出频道"},{default:t(()=>[l(b,{modelValue:r.channel,"onUpdate:modelValue":e[6]||(e[6]=a=>r.channel=a),placeholder:"如：CCTV-1、河南卫视等"},null,8,["modelValue"])]),_:1}),l(d,{label:"Logo地址"},{default:t(()=>[l(b,{modelValue:r.logo,"onUpdate:modelValue":e[7]||(e[7]=a=>r.logo=a),placeholder:"/images/gala/cctv-logo.png"},null,8,["modelValue"])]),_:1}),l(d,{label:"海报地址"},{default:t(()=>[l(b,{modelValue:r.poster,"onUpdate:modelValue":e[8]||(e[8]=a=>r.poster=a),placeholder:"/images/gala/cctv-poster.png"},null,8,["modelValue"])]),_:1}),l(d,{label:"描述"},{default:t(()=>[l(b,{modelValue:r.description,"onUpdate:modelValue":e[9]||(e[9]=a=>r.description=a),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),l(d,{label:"排序"},{default:t(()=>[l(E,{modelValue:r.sort,"onUpdate:modelValue":e[10]||(e[10]=a=>r.sort=a),min:0},null,8,["modelValue"])]),_:1}),l(d,{label:"是否显示"},{default:t(()=>[l(Ve,{modelValue:r.isShow,"onUpdate:modelValue":e[11]||(e[11]=a=>r.isShow=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:h.value,"onUpdate:modelValue":e[20]||(e[20]=a=>h.value=a),title:z.value,width:"600px",onClosed:ve},{footer:t(()=>[l(f,{onClick:e[19]||(e[19]=a=>h.value=!1)},{default:t(()=>[...e[32]||(e[32]=[p("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:fe,loading:j.value},{default:t(()=>[...e[33]||(e[33]=[p(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Q,{ref_key:"programFormRef",ref:x,model:u,rules:oe,"label-width":"100px"},{default:t(()=>[l(d,{label:"节目名称",prop:"title"},{default:t(()=>[l(b,{modelValue:u.title,"onUpdate:modelValue":e[14]||(e[14]=a=>u.title=a),placeholder:"请输入节目名称"},null,8,["modelValue"])]),_:1}),l(d,{label:"节目类型"},{default:t(()=>[l(b,{modelValue:u.type,"onUpdate:modelValue":e[15]||(e[15]=a=>u.type=a),placeholder:"如：歌舞、小品、相声等"},null,8,["modelValue"])]),_:1}),l(d,{label:"表演者"},{default:t(()=>[l(b,{modelValue:u.performers,"onUpdate:modelValue":e[16]||(e[16]=a=>u.performers=a),placeholder:"请输入表演者，多个用逗号分隔"},null,8,["modelValue"])]),_:1}),l(d,{label:"播出时间"},{default:t(()=>[l(K,{modelValue:u.airTime,"onUpdate:modelValue":e[17]||(e[17]=a=>u.airTime=a),placeholder:"选择播出时间",style:{width:"100%"},"value-format":"HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(d,{label:"节目序号"},{default:t(()=>[l(E,{modelValue:u.orderNum,"onUpdate:modelValue":e[18]||(e[18]=a=>u.orderNum=a),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Qe=De(Oe,[["__scopeId","data-v-88faa2ec"]]);export{Qe as default};
