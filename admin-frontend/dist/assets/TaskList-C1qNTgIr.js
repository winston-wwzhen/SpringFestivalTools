import{h as v}from"./request-DBgMPdsc.js";import{d as ye,v as be,o as k,c as j,a as u,b as a,w as l,z as K,l as D,i as c,j as q,r as o,A as ke,h as n,t as p,q as Ce,E as m,s as Ve,y as ze}from"./index-B1eIv2r7.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const we=i=>v.get("/crawler/tasks",{params:i}),xe=i=>v.post("/crawler/tasks",i),Te=(i,y)=>v.put(`/crawler/tasks/${i}`,y),Se=i=>v.delete(`/crawler/tasks/${i}`),De=i=>v.post(`/crawler/tasks/${i}/run`),Ee=i=>v.post(`/crawler/tasks/${i}/pause`),$e=i=>v.post(`/crawler/tasks/${i}/resume`),Me=(i,y)=>v.get(`/crawler/tasks/${i}/logs`,{params:y}),he={class:"crawler-page page-container"},Re={class:"actions-bar"},Le={class:"card"},Pe={style:{color:"#f56c6c"}},Be={class:"pagination-container"},Ne={style:{color:"#67c23a"}},je={style:{color:"#409eff"}},qe={key:0,style:{color:"#f56c6c"}},Oe={key:1},Ae={class:"pagination-container"},Je=ye({__name:"TaskList",setup(i){const y=c(!1),O=c([]),_=q({page:1,pageSize:20,total:0}),C=c(!1),E=c("新建任务"),x=c(),$=c(!1),z=c(null),r=q({name:"",type:"redpack",sourceUrl:"",cronExpression:"",config:{},status:"active"}),A=Ce({get:()=>JSON.stringify(r.config,null,2),set:s=>{try{r.config=JSON.parse(s)}catch{r.config={}}}}),Q={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],sourceUrl:[{required:!0,message:"请输入数据源URL",trigger:"blur"}],cronExpression:[{required:!0,message:"请输入Cron表达式",trigger:"blur"}]},M=c(!1),h=c(!1),J=c([]),R=c(null),g=q({page:1,pageSize:20,total:0}),W={redpack:"红包活动",gala:"春晚节目",emoticon:"表情包",kinship:"亲戚称呼"},X={active:"运行中",paused:"已暂停",disabled:"已禁用"},Z={active:"success",paused:"warning",disabled:"info"},ee={running:"运行中",success:"成功",failed:"失败"},te={running:"warning",success:"success",failed:"danger"},b=async()=>{y.value=!0;try{const s={page:_.page,pageSize:_.pageSize},e=await we(s);O.value=e.list,_.total=e.total}catch(s){console.error("加载数据失败:",s)}finally{y.value=!1}},ae=()=>{E.value="新建任务",z.value=null,Object.assign(r,{name:"",type:"redpack",sourceUrl:"",cronExpression:"0 */2 * * *",config:{},status:"active"}),C.value=!0},le=s=>{E.value="编辑任务",z.value=s.id,Object.assign(r,{name:s.name,type:s.type,sourceUrl:s.sourceUrl,cronExpression:s.cronExpression,config:s.config||{},status:s.status}),C.value=!0},se=async()=>{x.value&&await x.value.validate(async s=>{if(s){$.value=!0;try{z.value?(await Te(z.value,r),m.success("更新成功")):(await xe(r),m.success("创建成功")),C.value=!1,b()}catch(e){m.error(e.message||"操作失败")}finally{$.value=!1}}})},oe=async s=>{try{await Ve.confirm(`确定要删除任务 "${s.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Se(s.id),m.success("删除成功"),b()}catch{}},ne=async s=>{try{await De(s.id),m.success("任务已启动")}catch(e){m.error(e.message||"启动失败")}},re=async s=>{try{await Ee(s.id),m.success("任务已暂停"),b()}catch(e){m.error(e.message||"暂停失败")}},ie=async s=>{try{await $e(s.id),m.success("任务已恢复"),b()}catch(e){m.error(e.message||"恢复失败")}},ue=s=>{R.value=s.id,g.page=1,M.value=!0,L()},L=async()=>{if(R.value){h.value=!0;try{const s={page:g.page,pageSize:g.pageSize},e=await Me(R.value,s);J.value=e.list,g.total=e.total}catch(s){console.error("加载日志失败:",s)}finally{h.value=!1}}},de=()=>{var s;(s=x.value)==null||s.resetFields(),z.value=null},P=s=>ze(s).format("YYYY-MM-DD HH:mm:ss");return be(()=>{b()}),(s,e)=>{const pe=o("Plus"),U=o("el-icon"),f=o("el-button"),d=o("el-table-column"),B=o("el-tag"),ce=o("el-link"),Y=o("VideoPlay"),me=o("VideoPause"),ge=o("Document"),I=o("el-table"),F=o("el-pagination"),T=o("el-input"),V=o("el-form-item"),S=o("el-option"),fe=o("el-select"),N=o("el-radio"),_e=o("el-radio-group"),ve=o("el-form"),H=o("el-dialog"),G=ke("loading");return k(),j("div",he,[e[29]||(e[29]=u("h2",{class:"page-title"},"爬虫管理",-1)),u("div",Re,[a(f,{type:"primary",onClick:ae},{default:l(()=>[a(U,null,{default:l(()=>[a(pe)]),_:1}),e[13]||(e[13]=n(" 新建任务 ",-1))]),_:1})]),u("div",Le,[K((k(),D(I,{data:O.value},{default:l(()=>[a(d,{prop:"name",label:"任务名称","min-width":"200"}),a(d,{prop:"type",label:"类型",width:"120"},{default:l(({row:t})=>[a(B,{size:"small"},{default:l(()=>[n(p(W[t.type]),1)]),_:2},1024)]),_:1}),a(d,{prop:"sourceUrl",label:"数据源",min_width:"200","show-overflow-tooltip":""},{default:l(({row:t})=>[a(ce,{href:t.sourceUrl,target:"_blank",type:"primary",underline:!1},{default:l(()=>[n(p(t.sourceUrl),1)]),_:2},1032,["href"])]),_:1}),a(d,{prop:"cronExpression",label:"Cron表达式",width:"150"}),a(d,{prop:"status",label:"状态",width:"100"},{default:l(({row:t})=>[a(B,{type:Z[t.status],size:"small"},{default:l(()=>[n(p(X[t.status]),1)]),_:2},1032,["type"])]),_:1}),a(d,{label:"统计",width:"150"},{default:l(({row:t})=>[u("span",null,"成功 "+p(t.successCount)+" 次",1),e[14]||(e[14]=u("br",null,null,-1)),u("span",Pe,"失败 "+p(t.failCount)+" 次",1)]),_:1}),a(d,{prop:"lastRunAt",label:"最后运行",width:"180"},{default:l(({row:t})=>[n(p(t.lastRunAt?P(t.lastRunAt):"-"),1)]),_:1}),a(d,{label:"操作",width:"280",fixed:"right"},{default:l(({row:t})=>[a(f,{size:"small",onClick:w=>ne(t)},{default:l(()=>[a(U,null,{default:l(()=>[a(Y)]),_:1}),e[15]||(e[15]=n(" 运行 ",-1))]),_:1},8,["onClick"]),t.status==="active"?(k(),D(f,{key:0,size:"small",type:"warning",onClick:w=>re(t)},{default:l(()=>[a(U,null,{default:l(()=>[a(me)]),_:1}),e[16]||(e[16]=n(" 暂停 ",-1))]),_:1},8,["onClick"])):(k(),D(f,{key:1,size:"small",type:"success",onClick:w=>ie(t)},{default:l(()=>[a(U,null,{default:l(()=>[a(Y)]),_:1}),e[17]||(e[17]=n(" 恢复 ",-1))]),_:1},8,["onClick"])),a(f,{size:"small",onClick:w=>ue(t)},{default:l(()=>[a(U,null,{default:l(()=>[a(ge)]),_:1}),e[18]||(e[18]=n(" 日志 ",-1))]),_:1},8,["onClick"]),a(f,{size:"small",onClick:w=>le(t)},{default:l(()=>[...e[19]||(e[19]=[n(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(f,{size:"small",type:"danger",onClick:w=>oe(t)},{default:l(()=>[...e[20]||(e[20]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,y.value]]),u("div",Be,[a(F,{"current-page":_.page,"onUpdate:currentPage":e[0]||(e[0]=t=>_.page=t),"page-size":_.pageSize,"onUpdate:pageSize":e[1]||(e[1]=t=>_.pageSize=t),total:_.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"])])]),a(H,{modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=t=>C.value=t),title:E.value,width:"600px",onClosed:de},{footer:l(()=>[a(f,{onClick:e[8]||(e[8]=t=>C.value=!1)},{default:l(()=>[...e[25]||(e[25]=[n("取消",-1)])]),_:1}),a(f,{type:"primary",onClick:se,loading:$.value},{default:l(()=>[...e[26]||(e[26]=[n(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(ve,{ref_key:"formRef",ref:x,model:r,rules:Q,"label-width":"120px"},{default:l(()=>[a(V,{label:"任务名称",prop:"name"},{default:l(()=>[a(T,{modelValue:r.name,"onUpdate:modelValue":e[2]||(e[2]=t=>r.name=t),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),a(V,{label:"爬取类型",prop:"type"},{default:l(()=>[a(fe,{modelValue:r.type,"onUpdate:modelValue":e[3]||(e[3]=t=>r.type=t),placeholder:"请选择类型",style:{width:"100%"}},{default:l(()=>[a(S,{label:"红包活动",value:"redpack"}),a(S,{label:"春晚节目",value:"gala"}),a(S,{label:"表情包",value:"emoticon"}),a(S,{label:"亲戚称呼",value:"kinship"})]),_:1},8,["modelValue"])]),_:1}),a(V,{label:"数据源URL",prop:"sourceUrl"},{default:l(()=>[a(T,{modelValue:r.sourceUrl,"onUpdate:modelValue":e[4]||(e[4]=t=>r.sourceUrl=t),placeholder:"请输入数据源URL"},null,8,["modelValue"])]),_:1}),a(V,{label:"Cron表达式",prop:"cronExpression"},{default:l(()=>[a(T,{modelValue:r.cronExpression,"onUpdate:modelValue":e[5]||(e[5]=t=>r.cronExpression=t),placeholder:"如: 0 */2 * * * (每2小时)"},null,8,["modelValue"]),e[21]||(e[21]=u("div",{class:"form-tip"}," 常用表达式：0 */2 * * * (每2小时) | 0 0 * * * (每天0点) | 0 0 */6 * * (每6小时) ",-1))]),_:1}),a(V,{label:"爬虫配置"},{default:l(()=>[a(T,{modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=t=>A.value=t),type:"textarea",rows:6,placeholder:'JSON格式，如: {"selectors": {"container": ".item", "title": ".title"}}'},null,8,["modelValue"])]),_:1}),a(V,{label:"状态",prop:"status"},{default:l(()=>[a(_e,{modelValue:r.status,"onUpdate:modelValue":e[7]||(e[7]=t=>r.status=t)},{default:l(()=>[a(N,{label:"active"},{default:l(()=>[...e[22]||(e[22]=[n("激活",-1)])]),_:1}),a(N,{label:"paused"},{default:l(()=>[...e[23]||(e[23]=[n("暂停",-1)])]),_:1}),a(N,{label:"disabled"},{default:l(()=>[...e[24]||(e[24]=[n("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(H,{modelValue:M.value,"onUpdate:modelValue":e[12]||(e[12]=t=>M.value=t),title:"执行日志",width:"900px"},{default:l(()=>[K((k(),D(I,{data:J.value,"max-height":"500"},{default:l(()=>[a(d,{prop:"startTime",label:"开始时间",width:"180"},{default:l(({row:t})=>[n(p(P(t.startTime)),1)]),_:1}),a(d,{prop:"endTime",label:"结束时间",width:"180"},{default:l(({row:t})=>[n(p(t.endTime?P(t.endTime):"-"),1)]),_:1}),a(d,{prop:"status",label:"状态",width:"100"},{default:l(({row:t})=>[a(B,{type:te[t.status],size:"small"},{default:l(()=>[n(p(ee[t.status]),1)]),_:2},1032,["type"])]),_:1}),a(d,{label:"数据统计",width:"200"},{default:l(({row:t})=>[u("span",null,"抓取 "+p(t.itemsFetched)+" 条",1),e[27]||(e[27]=u("br",null,null,-1)),u("span",Ne,"新增 "+p(t.itemsCreated)+" 条",1),e[28]||(e[28]=u("br",null,null,-1)),u("span",je,"更新 "+p(t.itemsUpdated)+" 条",1)]),_:1}),a(d,{prop:"errorMessage",label:"错误信息","min-width":"200","show-overflow-tooltip":""},{default:l(({row:t})=>[t.errorMessage?(k(),j("span",qe,p(t.errorMessage),1)):(k(),j("span",Oe,"-"))]),_:1})]),_:1},8,["data"])),[[G,h.value]]),u("div",Ae,[a(F,{"current-page":g.page,"onUpdate:currentPage":e[10]||(e[10]=t=>g.page=t),"page-size":g.pageSize,"onUpdate:pageSize":e[11]||(e[11]=t=>g.pageSize=t),total:g.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:L,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])])}}}),He=Ue(Je,[["__scopeId","data-v-ebcb623e"]]);export{He as default};
