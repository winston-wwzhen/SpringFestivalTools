import{h as P}from"./request-BQix10f2.js";import{d as ke,j as ee,v as Se,o as v,c as D,a as _,b as l,w as a,z as le,l as Y,y as De,i as m,r as n,A as Ue,h as p,t as $,F as te,C as ae,q as Ne,E as y,s as oe}from"./index-DhSdXOSu.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $e=u=>P.get("/admin/gala/platforms",{params:u}),Fe=u=>P.post("/admin/gala/platforms",u),ze=(u,V)=>P.put(`/admin/gala/platforms/${u}`,V),Be=u=>P.delete(`/admin/gala/platforms/${u}`),Me=u=>P.get("/admin/gala/programs",{params:u}),Ye=u=>P.post("/admin/gala/programs",u),Ee=(u,V)=>P.put(`/admin/gala/programs/${u}`,V),Re=u=>P.delete(`/admin/gala/programs/${u}`),h={adminGetPlatforms:$e,createPlatform:Fe,updatePlatform:ze,deletePlatform:Be,adminGetPrograms:Me,createProgram:Ye,updateProgram:Ee,deleteProgram:Re},Ie={class:"gala-list-page page-container"},qe={key:0},Ge={class:"actions-bar"},He={class:"card"},Le={style:{"font-size":"24px"}},Oe={key:1},Ae={class:"search-form"},Je={class:"search-form-item"},Ke={key:0,class:"actions-bar"},Qe={class:"card"},We=ke({__name:"List",setup(u){const V=m("platforms"),x=m(!1),E=m([]),R=m([]),re=Ne(()=>E.value.filter(o=>o.reviewStatus==="approved")),T=m(null),C=m(!1),I=m("æ–°å»ºå¹³å°"),F=m(),q=m(!1),U=m(null),r=ee({name:"",shortName:"",emoji:"ðŸ“º",year:new Date().getFullYear(),airDate:"",airTime:"",channel:"",logo:"",poster:"",description:"",sort:0,isShow:!0,tags:[],tagsText:""}),ne={name:[{required:!0,message:"è¯·è¾“å…¥å¹³å°åç§°",trigger:"blur"}],year:[{required:!0,message:"è¯·è¾“å…¥å¹´ä»½",trigger:"blur"}]},k=m(!1),G=m("æ–°å»ºèŠ‚ç›®"),z=m(),H=m(!1),N=m(null),d=ee({title:"",type:"",performers:"",airTime:"",orderNum:0}),se={title:[{required:!0,message:"è¯·è¾“å…¥èŠ‚ç›®åç§°",trigger:"blur"}]},ie={pending:"å¾…å®¡æ ¸",approved:"å·²é€šè¿‡",rejected:"å·²æ‹’ç»"},ue={pending:"warning",approved:"success",rejected:"danger"},de=(o,e)=>{if(!o&&!e)return"-";let c="";if(o){const S=new Date(o),M=S.getFullYear(),f=String(S.getMonth()+1).padStart(2,"0"),s=String(S.getDate()).padStart(2,"0");c=`${M}-${f}-${s}`}const b=e||"";return c&&b?`${c} ${b.substring(0,5)}`:c||b},B=async()=>{x.value=!0;try{const o=await h.adminGetPlatforms({});E.value=o.list||[]}catch(o){console.error("åŠ è½½å¹³å°å¤±è´¥:",o)}finally{x.value=!1}},L=async()=>{if(T.value){x.value=!0;try{const o=await h.adminGetPrograms({platformId:T.value});R.value=o.list||[]}catch(o){console.error("åŠ è½½èŠ‚ç›®å¤±è´¥:",o)}finally{x.value=!1}}},me=()=>{V.value==="platforms"&&B()},pe=()=>{I.value="æ–°å»ºå¹³å°",U.value=null,Object.assign(r,{name:"",shortName:"",emoji:"ðŸ“º",year:new Date().getFullYear(),airDate:"",airTime:"",channel:"",logo:"",poster:"",description:"",sort:0,isShow:!0,tags:[],tagsText:""}),C.value=!0},fe=o=>{I.value="ç¼–è¾‘å¹³å°",U.value=o.id;const e=Array.isArray(o.tags)?o.tags:[];Object.assign(r,{name:o.name,shortName:o.shortName||"",emoji:o.emoji||"ðŸ“º",year:o.year||new Date().getFullYear(),airDate:o.airDate||"",airTime:o.airTime||"",channel:o.channel||"",logo:o.logo||"",poster:o.poster||"",description:o.description||"",sort:o.sort||0,isShow:o.isShow!==void 0?o.isShow:!0,tags:e,tagsText:e.join(", ")}),C.value=!0},ge=async()=>{F.value&&await F.value.validate(async o=>{if(o){q.value=!0;try{const e=r.tagsText?r.tagsText.split(",").map(b=>b.trim()).filter(b=>b):[],c={...r,tags:e};U.value?(await h.updatePlatform(U.value,c),y.success("æ›´æ–°æˆåŠŸ")):(await h.createPlatform(c),y.success("åˆ›å»ºæˆåŠŸ")),C.value=!1,B()}catch(e){y.error(e.message||"æ“ä½œå¤±è´¥")}finally{q.value=!1}}})},ce=async o=>{try{await oe.confirm(`ç¡®å®šè¦åˆ é™¤å¹³å° "${o.name}" å—ï¼Ÿ`,"æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await h.deletePlatform(o.id),y.success("åˆ é™¤æˆåŠŸ"),B()}catch{}},ve=()=>{var o;(o=F.value)==null||o.resetFields(),U.value=null},_e=()=>{if(!T.value){y.warning("è¯·å…ˆé€‰æ‹©å¹³å°");return}G.value="æ–°å»ºèŠ‚ç›®",N.value=null,Object.assign(d,{title:"",type:"",performers:"",airTime:"",orderNum:R.value.length+1}),k.value=!0},be=o=>{G.value="ç¼–è¾‘èŠ‚ç›®",N.value=o.id,Object.assign(d,{title:o.title,type:o.type||"",performers:o.performers||"",airTime:o.airTime||"",orderNum:o.orderNum||0}),k.value=!0},ye=async()=>{z.value&&await z.value.validate(async o=>{if(o){H.value=!0;try{N.value?(await h.updateProgram(N.value,d),y.success("æ›´æ–°æˆåŠŸ")):(await h.createProgram({...d,platform_id:T.value}),y.success("åˆ›å»ºæˆåŠŸ")),k.value=!1,L()}catch(e){y.error(e.message||"æ“ä½œå¤±è´¥")}finally{H.value=!1}}})},Ve=async o=>{try{await oe.confirm(`ç¡®å®šè¦åˆ é™¤èŠ‚ç›® "${o.title}" å—ï¼Ÿ`,"æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await h.deleteProgram(o.id),y.success("åˆ é™¤æˆåŠŸ"),L()}catch{}},we=()=>{var o;(o=z.value)==null||o.resetFields(),N.value=null};return Se(()=>{B()}),(o,e)=>{const c=n("el-tab-pane"),b=n("el-tabs"),S=n("Plus"),M=n("el-icon"),f=n("el-button"),s=n("el-table-column"),O=n("el-tag"),K=n("el-table"),he=n("el-option"),Pe=n("el-select"),g=n("el-input"),i=n("el-form-item"),w=n("el-col"),A=n("el-row"),J=n("el-input-number"),Te=n("el-date-picker"),Q=n("el-time-picker"),xe=n("el-switch"),W=n("el-form"),X=n("el-dialog"),Z=Ue("loading");return v(),D("div",Ie,[e[37]||(e[37]=_("h2",{class:"page-title"},"æ˜¥æ™šç®¡ç†",-1)),l(b,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t),onTabChange:me},{default:a(()=>[l(c,{label:"æ˜¥æ™šå¹³å°",name:"platforms"},{label:a(()=>[...e[24]||(e[24]=[_("span",null,"æ˜¥æ™šå¹³å°",-1)])]),_:1}),l(c,{label:"èŠ‚ç›®å•",name:"programs"},{label:a(()=>[...e[25]||(e[25]=[_("span",null,"èŠ‚ç›®å•",-1)])]),_:1})]),_:1},8,["modelValue"]),V.value==="platforms"?(v(),D("div",qe,[_("div",Ge,[l(f,{type:"primary",onClick:pe},{default:a(()=>[l(M,null,{default:a(()=>[l(S)]),_:1}),e[26]||(e[26]=p(" æ–°å»ºå¹³å° ",-1))]),_:1})]),_("div",He,[le((v(),Y(K,{data:E.value},{default:a(()=>[l(s,{prop:"emoji",label:"å›¾æ ‡",width:"60"},{default:a(({row:t})=>[_("span",Le,$(t.emoji||"ðŸ“º"),1)]),_:1}),l(s,{prop:"name",label:"å¹³å°åç§°","min-width":"150"}),l(s,{prop:"shortName",label:"ç®€ç§°",width:"80"}),l(s,{prop:"year",label:"å¹´ä»½",width:"80"}),l(s,{label:"æ’­å‡ºæ—¶é—´","min-width":"160"},{default:a(({row:t})=>[p($(de(t.airDate,t.airTime)),1)]),_:1}),l(s,{prop:"channel",label:"é¢‘é“","min-width":"120"}),l(s,{prop:"tags",label:"æ ‡ç­¾","min-width":"200"},{default:a(({row:t})=>[(v(!0),D(te,null,ae(t.tags,(j,Ce)=>(v(),Y(O,{key:Ce,size:"small",style:{"margin-right":"4px"}},{default:a(()=>[p($(j),1)]),_:2},1024))),128))]),_:1}),l(s,{prop:"isShow",label:"æ˜¾ç¤º",width:"80"},{default:a(({row:t})=>[l(O,{type:t.isShow?"success":"info",size:"small"},{default:a(()=>[p($(t.isShow?"æ˜¾ç¤º":"éšè—"),1)]),_:2},1032,["type"])]),_:1}),l(s,{prop:"sort",label:"æŽ’åº",width:"80"}),l(s,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:a(({row:t})=>[l(f,{size:"small",onClick:j=>fe(t)},{default:a(()=>[...e[27]||(e[27]=[p("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:j=>ce(t)},{default:a(()=>[...e[28]||(e[28]=[p("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,x.value]])])])):(v(),D("div",Oe,[_("div",Ae,[_("div",Je,[e[29]||(e[29]=_("label",null,"é€‰æ‹©å¹³å°",-1)),l(Pe,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=t=>T.value=t),placeholder:"è¯·é€‰æ‹©å¹³å°",onChange:L,style:{width:"200px"}},{default:a(()=>[(v(!0),D(te,null,ae(re.value,t=>(v(),Y(he,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),T.value?(v(),D("div",Ke,[l(f,{type:"primary",onClick:_e},{default:a(()=>[l(M,null,{default:a(()=>[l(S)]),_:1}),e[30]||(e[30]=p(" æ–°å»ºèŠ‚ç›® ",-1))]),_:1})])):De("",!0),_("div",Qe,[le((v(),Y(K,{data:R.value},{default:a(()=>[l(s,{prop:"orderNum",label:"åºå·",width:"80"}),l(s,{prop:"title",label:"èŠ‚ç›®åç§°","min-width":"200"}),l(s,{prop:"type",label:"ç±»åž‹",width:"120"}),l(s,{prop:"performers",label:"è¡¨æ¼”è€…","min-width":"200","show-overflow-tooltip":""}),l(s,{prop:"airTime",label:"æ’­å‡ºæ—¶é—´",width:"100"}),l(s,{prop:"reviewStatus",label:"å®¡æ ¸çŠ¶æ€",width:"100"},{default:a(({row:t})=>[l(O,{type:ue[t.reviewStatus],size:"small"},{default:a(()=>[p($(ie[t.reviewStatus]),1)]),_:2},1032,["type"])]),_:1}),l(s,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:a(({row:t})=>[l(f,{size:"small",onClick:j=>be(t)},{default:a(()=>[...e[31]||(e[31]=[p("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:j=>Ve(t)},{default:a(()=>[...e[32]||(e[32]=[p("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,x.value]])])])),l(X,{modelValue:C.value,"onUpdate:modelValue":e[16]||(e[16]=t=>C.value=t),title:I.value,width:"600px",onClosed:ve},{footer:a(()=>[l(f,{onClick:e[15]||(e[15]=t=>C.value=!1)},{default:a(()=>[...e[33]||(e[33]=[p("å–æ¶ˆ",-1)])]),_:1}),l(f,{type:"primary",onClick:ge,loading:q.value},{default:a(()=>[...e[34]||(e[34]=[p(" ç¡®å®š ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(W,{ref_key:"platformFormRef",ref:F,model:r,rules:ne,"label-width":"110px"},{default:a(()=>[l(A,{gutter:20},{default:a(()=>[l(w,{span:12},{default:a(()=>[l(i,{label:"å¹³å°åç§°",prop:"name"},{default:a(()=>[l(g,{modelValue:r.name,"onUpdate:modelValue":e[2]||(e[2]=t=>r.name=t),placeholder:"å¦‚ï¼šå¤®è§†æ˜¥æ™šã€æ²³å—æ˜¥æ™šç­‰"},null,8,["modelValue"])]),_:1})]),_:1}),l(w,{span:6},{default:a(()=>[l(i,{label:"ç®€ç§°",prop:"shortName"},{default:a(()=>[l(g,{modelValue:r.shortName,"onUpdate:modelValue":e[3]||(e[3]=t=>r.shortName=t),placeholder:"å¤®",maxlength:"1"},null,8,["modelValue"])]),_:1})]),_:1}),l(w,{span:6},{default:a(()=>[l(i,{label:"Emojiå›¾æ ‡"},{default:a(()=>[l(g,{modelValue:r.emoji,"onUpdate:modelValue":e[4]||(e[4]=t=>r.emoji=t),placeholder:"ðŸ“º",maxlength:"2"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(A,{gutter:20},{default:a(()=>[l(w,{span:8},{default:a(()=>[l(i,{label:"å¹´ä»½",prop:"year"},{default:a(()=>[l(J,{modelValue:r.year,"onUpdate:modelValue":e[5]||(e[5]=t=>r.year=t),min:2e3,max:2100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(w,{span:8},{default:a(()=>[l(i,{label:"æ’­å‡ºæ—¥æœŸ"},{default:a(()=>[l(Te,{modelValue:r.airDate,"onUpdate:modelValue":e[6]||(e[6]=t=>r.airDate=t),type:"date",placeholder:"é€‰æ‹©æ’­å‡ºæ—¥æœŸ",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),l(w,{span:8},{default:a(()=>[l(i,{label:"æ’­å‡ºæ—¶é—´"},{default:a(()=>[l(Q,{modelValue:r.airTime,"onUpdate:modelValue":e[7]||(e[7]=t=>r.airTime=t),placeholder:"é€‰æ‹©æ’­å‡ºæ—¶é—´",style:{width:"100%"},"value-format":"HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(i,{label:"æ’­å‡ºé¢‘é“"},{default:a(()=>[l(g,{modelValue:r.channel,"onUpdate:modelValue":e[8]||(e[8]=t=>r.channel=t),placeholder:"å¦‚ï¼šCCTV-1ã€æ²³å—å«è§†ç­‰"},null,8,["modelValue"])]),_:1}),l(i,{label:"æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰"},{default:a(()=>[l(g,{modelValue:r.tagsText,"onUpdate:modelValue":e[9]||(e[9]=t=>r.tagsText=t),placeholder:"å¤®è§†, ä¸»ä¼šåœº, å…¨çƒç›´æ’­"},null,8,["modelValue"])]),_:1}),l(i,{label:"Logoåœ°å€"},{default:a(()=>[l(g,{modelValue:r.logo,"onUpdate:modelValue":e[10]||(e[10]=t=>r.logo=t),placeholder:"/images/gala/cctv-logo.png"},null,8,["modelValue"])]),_:1}),l(i,{label:"æµ·æŠ¥åœ°å€"},{default:a(()=>[l(g,{modelValue:r.poster,"onUpdate:modelValue":e[11]||(e[11]=t=>r.poster=t),placeholder:"/images/gala/cctv-poster.png"},null,8,["modelValue"])]),_:1}),l(i,{label:"æè¿°"},{default:a(()=>[l(g,{modelValue:r.description,"onUpdate:modelValue":e[12]||(e[12]=t=>r.description=t),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥æè¿°"},null,8,["modelValue"])]),_:1}),l(A,{gutter:20},{default:a(()=>[l(w,{span:12},{default:a(()=>[l(i,{label:"æŽ’åº"},{default:a(()=>[l(J,{modelValue:r.sort,"onUpdate:modelValue":e[13]||(e[13]=t=>r.sort=t),min:0},null,8,["modelValue"])]),_:1})]),_:1}),l(w,{span:12},{default:a(()=>[l(i,{label:"æ˜¯å¦æ˜¾ç¤º"},{default:a(()=>[l(xe,{modelValue:r.isShow,"onUpdate:modelValue":e[14]||(e[14]=t=>r.isShow=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(X,{modelValue:k.value,"onUpdate:modelValue":e[23]||(e[23]=t=>k.value=t),title:G.value,width:"600px",onClosed:we},{footer:a(()=>[l(f,{onClick:e[22]||(e[22]=t=>k.value=!1)},{default:a(()=>[...e[35]||(e[35]=[p("å–æ¶ˆ",-1)])]),_:1}),l(f,{type:"primary",onClick:ye,loading:H.value},{default:a(()=>[...e[36]||(e[36]=[p(" ç¡®å®š ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(W,{ref_key:"programFormRef",ref:z,model:d,rules:se,"label-width":"100px"},{default:a(()=>[l(i,{label:"èŠ‚ç›®åç§°",prop:"title"},{default:a(()=>[l(g,{modelValue:d.title,"onUpdate:modelValue":e[17]||(e[17]=t=>d.title=t),placeholder:"è¯·è¾“å…¥èŠ‚ç›®åç§°"},null,8,["modelValue"])]),_:1}),l(i,{label:"èŠ‚ç›®ç±»åž‹"},{default:a(()=>[l(g,{modelValue:d.type,"onUpdate:modelValue":e[18]||(e[18]=t=>d.type=t),placeholder:"å¦‚ï¼šæ­Œèˆžã€å°å“ã€ç›¸å£°ç­‰"},null,8,["modelValue"])]),_:1}),l(i,{label:"è¡¨æ¼”è€…"},{default:a(()=>[l(g,{modelValue:d.performers,"onUpdate:modelValue":e[19]||(e[19]=t=>d.performers=t),placeholder:"è¯·è¾“å…¥è¡¨æ¼”è€…ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”"},null,8,["modelValue"])]),_:1}),l(i,{label:"æ’­å‡ºæ—¶é—´"},{default:a(()=>[l(Q,{modelValue:d.airTime,"onUpdate:modelValue":e[20]||(e[20]=t=>d.airTime=t),placeholder:"é€‰æ‹©æ’­å‡ºæ—¶é—´",style:{width:"100%"},"value-format":"HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(i,{label:"èŠ‚ç›®åºå·"},{default:a(()=>[l(J,{modelValue:d.orderNum,"onUpdate:modelValue":e[21]||(e[21]=t=>d.orderNum=t),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ll=je(We,[["__scopeId","data-v-3bcd318a"]]);export{ll as default};
