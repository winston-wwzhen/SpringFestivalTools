import{b as se,g as re,c as ie,r as de,d as ue}from"./audit-ATted_gH.js";import{d as pe,v as me,o as u,c as T,a as r,b as t,w as l,t as S,y as b,z as ce,l as g,i as f,j as z,r as n,A as ge,h as s,E as j,x as fe,s as _e}from"./index-BNku7GA3.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-dNMU54ll.js";const be={class:"audit-page page-container"},ye={class:"search-form"},ke={class:"search-form-item"},we={key:0,class:"batch-actions"},Ve={class:"selection-info"},Ce={class:"card"},xe={class:"title-cell"},he={class:"title"},Se={key:1},ze={class:"pagination-container"},je=pe({__name:"PendingList",setup(De){const y=f("redpack"),D=f(!1),$=f([]),_=f([]),U=f(""),i=z({redpack:0,gala_platform:0,gala_program:0,emoticon:0,kinship:0}),d=z({page:1,pageSize:20,total:0}),w=f(!1),A=f("审核备注"),v=z({note:"",currentId:null}),V=f(!1),c=z({reason:"",currentId:null}),m=async()=>{D.value=!0;try{const o={type:y.value,page:d.page,pageSize:d.pageSize},e=await se(o);$.value=e.list,d.total=e.total,e.stats&&Object.assign(i,e.stats)}catch(o){console.error("加载数据失败:",o)}finally{D.value=!1}},E=async()=>{try{const o=await re();Object.assign(i,o)}catch(o){console.error("加载统计失败:",o)}},N=()=>{d.page=1,m()},P=()=>{d.page=1,m()},Y=()=>{U.value="",d.page=1,m()},F=o=>{_.value=o},H=o=>{v.currentId=o.id,v.note="",A.value=`审核通过 - ${o.title||o.name}`,w.value=!0},O=async()=>{try{await ie(y.value,v.currentId,v.note),j.success("审核通过"),w.value=!1,m()}catch(o){console.error("审核失败:",o)}},q=o=>{c.currentId=o.id,c.reason="",V.value=!0},K=async()=>{if(!c.reason){j.warning("请输入拒绝理由");return}try{await de(y.value,c.currentId,c.reason),j.success("已拒绝"),V.value=!1,m()}catch(o){console.error("拒绝失败:",o)}},G=async()=>{try{await _e.confirm(`确定要批量通过 ${_.value.length} 项内容吗？`,"批量审核",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const o=_.value.map(e=>e.id);await ue(y.value,o),j.success(`已批量通过 ${o.length} 项内容`),_.value=[],m()}catch{}},J=o=>fe(o).format("YYYY-MM-DD HH:mm");return me(()=>{m(),E()}),(o,e)=>{const C=n("el-badge"),x=n("el-tab-pane"),Q=n("el-tabs"),I=n("Search"),h=n("el-icon"),B=n("el-input"),p=n("el-button"),W=n("RefreshLeft"),X=n("Select"),k=n("el-table-column"),Z=n("el-tag"),ee=n("Link"),te=n("el-link"),le=n("el-table"),ae=n("el-pagination"),L=n("el-form-item"),M=n("el-form"),R=n("el-dialog"),oe=ge("loading");return u(),T("div",be,[e[27]||(e[27]=r("h2",{class:"page-title"},"待审核列表",-1)),t(Q,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),onTabChange:N},{default:l(()=>[t(x,{label:"红包活动",name:"redpack"},{label:l(()=>[e[11]||(e[11]=r("span",null,"红包活动",-1)),i.redpack>0?(u(),g(C,{key:0,value:i.redpack,class:"tab-badge"},null,8,["value"])):b("",!0)]),_:1}),t(x,{label:"春晚平台",name:"gala_platform"},{label:l(()=>[e[12]||(e[12]=r("span",null,"春晚平台",-1)),i.gala_platform>0?(u(),g(C,{key:0,value:i.gala_platform,class:"tab-badge"},null,8,["value"])):b("",!0)]),_:1}),t(x,{label:"春晚节目",name:"gala_program"},{label:l(()=>[e[13]||(e[13]=r("span",null,"春晚节目",-1)),i.gala_program>0?(u(),g(C,{key:0,value:i.gala_program,class:"tab-badge"},null,8,["value"])):b("",!0)]),_:1}),t(x,{label:"表情包",name:"emoticon"},{label:l(()=>[e[14]||(e[14]=r("span",null,"表情包",-1)),i.emoticon>0?(u(),g(C,{key:0,value:i.emoticon,class:"tab-badge"},null,8,["value"])):b("",!0)]),_:1}),t(x,{label:"亲戚称呼",name:"kinship"},{label:l(()=>[e[15]||(e[15]=r("span",null,"亲戚称呼",-1)),i.kinship>0?(u(),g(C,{key:0,value:i.kinship,class:"tab-badge"},null,8,["value"])):b("",!0)]),_:1})]),_:1},8,["modelValue"]),r("div",ye,[r("div",ke,[t(B,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=a=>U.value=a),placeholder:"搜索标题/名称",clearable:"",style:{width:"200px"}},{prefix:l(()=>[t(h,null,{default:l(()=>[t(I)]),_:1})]),_:1},8,["modelValue"])]),t(p,{type:"primary",onClick:P},{default:l(()=>[t(h,null,{default:l(()=>[t(I)]),_:1}),e[16]||(e[16]=s(" 搜索 ",-1))]),_:1}),t(p,{onClick:Y},{default:l(()=>[t(h,null,{default:l(()=>[t(W)]),_:1}),e[17]||(e[17]=s(" 重置 ",-1))]),_:1})]),_.value.length>0?(u(),T("div",we,[r("span",Ve,"已选择 "+S(_.value.length)+" 项",1),t(p,{type:"success",onClick:G},{default:l(()=>[t(h,null,{default:l(()=>[t(X)]),_:1}),e[18]||(e[18]=s(" 批量通过 ",-1))]),_:1}),t(p,{onClick:e[2]||(e[2]=a=>_.value=[])},{default:l(()=>[...e[19]||(e[19]=[s(" 取消选择 ",-1)])]),_:1})])):b("",!0),r("div",Ce,[ce((u(),g(le,{data:$.value,onSelectionChange:F},{default:l(()=>[t(k,{type:"selection",width:"55"}),t(k,{label:"标题/名称","min-width":"200"},{default:l(({row:a})=>[r("div",xe,[r("span",he,S(a.title||a.name),1),a.platform?(u(),g(Z,{key:0,size:"small",class:"platform-tag"},{default:l(()=>[s(S(a.platform),1)]),_:2},1024)):b("",!0)])]),_:1}),t(k,{label:"描述","min-width":"200","show-overflow-tooltip":""},{default:l(({row:a})=>[s(S(a.description||"-"),1)]),_:1}),t(k,{label:"数据来源",width:"150"},{default:l(({row:a})=>[a.sourceUrl?(u(),g(te,{key:0,href:a.sourceUrl,target:"_blank",type:"primary",underline:!1},{default:l(()=>[t(h,null,{default:l(()=>[t(ee)]),_:1}),e[20]||(e[20]=s(" 查看来源 ",-1))]),_:1},8,["href"])):(u(),T("span",Se,"-"))]),_:1}),t(k,{label:"提交时间",width:"180"},{default:l(({row:a})=>[s(S(J(a.createdAt)),1)]),_:1}),t(k,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[t(p,{type:"success",size:"small",onClick:ne=>H(a)},{default:l(()=>[...e[21]||(e[21]=[s(" 通过 ",-1)])]),_:1},8,["onClick"]),t(p,{type:"danger",size:"small",onClick:ne=>q(a)},{default:l(()=>[...e[22]||(e[22]=[s(" 拒绝 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,D.value]]),r("div",ze,[t(ae,{"current-page":d.page,"onUpdate:currentPage":e[3]||(e[3]=a=>d.page=a),"page-size":d.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>d.pageSize=a),total:d.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:m,onCurrentChange:m},null,8,["current-page","page-size","total"])])]),t(R,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=a=>w.value=a),title:A.value,width:"500px"},{footer:l(()=>[t(p,{onClick:e[6]||(e[6]=a=>w.value=!1)},{default:l(()=>[...e[23]||(e[23]=[s("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:O},{default:l(()=>[...e[24]||(e[24]=[s("确定",-1)])]),_:1})]),default:l(()=>[t(M,{model:v,"label-width":"80px"},{default:l(()=>[t(L,{label:"备注"},{default:l(()=>[t(B,{modelValue:v.note,"onUpdate:modelValue":e[5]||(e[5]=a=>v.note=a),type:"textarea",rows:4,placeholder:"请输入审核备注（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(R,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=a=>V.value=a),title:"拒绝理由",width:"500px"},{footer:l(()=>[t(p,{onClick:e[9]||(e[9]=a=>V.value=!1)},{default:l(()=>[...e[25]||(e[25]=[s("取消",-1)])]),_:1}),t(p,{type:"danger",onClick:K},{default:l(()=>[...e[26]||(e[26]=[s("确定拒绝",-1)])]),_:1})]),default:l(()=>[t(M,{model:c,"label-width":"80px"},{default:l(()=>[t(L,{label:"拒绝理由",required:""},{default:l(()=>[t(B,{modelValue:c.reason,"onUpdate:modelValue":e[8]||(e[8]=a=>c.reason=a),type:"textarea",rows:4,placeholder:"请输入拒绝理由",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ae=ve(je,[["__scopeId","data-v-1905af99"]]);export{Ae as default};
