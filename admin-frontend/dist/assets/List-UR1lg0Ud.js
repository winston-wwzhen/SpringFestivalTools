import{h as y}from"./request-D7X3TMUr.js";import{d as Ve,v as we,o as _,c as h,a as v,b as l,w as o,z as X,l as R,y as Pe,i as d,r as n,A as Ce,h as m,t as Z,F as ke,C as Te,q as De,j as ee,E as c,s as le}from"./index-DQuHESS9.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe=s=>y.get("/admin/gala/platforms",{params:s}),Se=s=>y.post("/admin/gala/platforms",s),Ue=(s,g)=>y.put(`/admin/gala/platforms/${s}`,g),Fe=s=>y.delete(`/admin/gala/platforms/${s}`),$e=s=>y.get("/admin/gala/programs",{params:s}),Ne=s=>y.post("/admin/gala/programs",s),Be=(s,g)=>y.put(`/admin/gala/programs/${s}`,g),je=s=>y.delete(`/admin/gala/programs/${s}`),b={adminGetPlatforms:xe,createPlatform:Se,updatePlatform:Ue,deletePlatform:Fe,adminGetPrograms:$e,createProgram:Ne,updateProgram:Be,deleteProgram:je},ze={class:"gala-list-page page-container"},Me={key:0},Ee={class:"actions-bar"},Re={class:"card"},Ie={key:1},Ge={class:"search-form"},He={class:"search-form-item"},Oe={key:0,class:"actions-bar"},Ye={class:"card"},qe=Ve({__name:"List",setup(s){const g=d("platforms"),w=d(!1),F=d([]),$=d([]),ae=De(()=>F.value.filter(t=>t.reviewStatus==="approved")),V=d(null),P=d(!1),N=d("新建平台"),x=d(),B=d(!1),T=d(null),r=ee({name:"",airDate:"",airTime:"",channel:"",description:"",sort:0}),te={name:[{required:!0,message:"请输入平台名称",trigger:"blur"}]},C=d(!1),j=d("新建节目"),S=d(),z=d(!1),D=d(null),i=ee({title:"",type:"",performers:"",airTime:"",orderNum:0}),oe={title:[{required:!0,message:"请输入节目名称",trigger:"blur"}]},I={pending:"待审核",approved:"已通过",rejected:"已拒绝"},G={pending:"warning",approved:"success",rejected:"danger"},U=async()=>{w.value=!0;try{const t=await b.adminGetPlatforms({});F.value=t}catch(t){console.error("加载平台失败:",t)}finally{w.value=!1}},M=async()=>{if(V.value){w.value=!0;try{const t=await b.adminGetPrograms({platformId:V.value});$.value=t}catch(t){console.error("加载节目失败:",t)}finally{w.value=!1}}},re=()=>{g.value==="platforms"&&U()},ne=()=>{N.value="新建平台",T.value=null,Object.assign(r,{name:"",airDate:"",airTime:"",channel:"",description:"",sort:0}),P.value=!0},se=t=>{N.value="编辑平台",T.value=t.id,Object.assign(r,{name:t.name,airDate:t.airDate||"",airTime:t.airTime||"",channel:t.channel||"",description:t.description||"",sort:t.sort||0}),P.value=!0},ie=async()=>{x.value&&await x.value.validate(async t=>{if(t){B.value=!0;try{T.value?(await b.updatePlatform(T.value,r),c.success("更新成功")):(await b.createPlatform(r),c.success("创建成功")),P.value=!1,U()}catch(e){c.error(e.message||"操作失败")}finally{B.value=!1}}})},de=async t=>{try{await le.confirm(`确定要删除平台 "${t.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await b.deletePlatform(t.id),c.success("删除成功"),U()}catch{}},ue=()=>{var t;(t=x.value)==null||t.resetFields(),T.value=null},me=()=>{if(!V.value){c.warning("请先选择平台");return}j.value="新建节目",D.value=null,Object.assign(i,{title:"",type:"",performers:"",airTime:"",orderNum:$.value.length+1}),C.value=!0},pe=t=>{j.value="编辑节目",D.value=t.id,Object.assign(i,{title:t.title,type:t.type||"",performers:t.performers||"",airTime:t.airTime||"",orderNum:t.orderNum||0}),C.value=!0},fe=async()=>{S.value&&await S.value.validate(async t=>{if(t){z.value=!0;try{D.value?(await b.updateProgram(D.value,i),c.success("更新成功")):(await b.createProgram({...i,platform_id:V.value}),c.success("创建成功")),C.value=!1,M()}catch(e){c.error(e.message||"操作失败")}finally{z.value=!1}}})},ve=async t=>{try{await le.confirm(`确定要删除节目 "${t.title}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await b.deleteProgram(t.id),c.success("删除成功"),M()}catch{}},ce=()=>{var t;(t=S.value)==null||t.resetFields(),D.value=null};return we(()=>{U()}),(t,e)=>{const H=n("el-tab-pane"),ge=n("el-tabs"),O=n("Plus"),Y=n("el-icon"),f=n("el-button"),u=n("el-table-column"),q=n("el-tag"),L=n("el-table"),_e=n("el-option"),be=n("el-select"),k=n("el-input"),p=n("el-form-item"),ye=n("el-date-picker"),A=n("el-time-picker"),J=n("el-input-number"),K=n("el-form"),Q=n("el-dialog"),W=Ce("loading");return _(),h("div",ze,[e[30]||(e[30]=v("h2",{class:"page-title"},"春晚管理",-1)),l(ge,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),onTabChange:re},{default:o(()=>[l(H,{label:"春晚平台",name:"platforms"},{label:o(()=>[...e[17]||(e[17]=[v("span",null,"春晚平台",-1)])]),_:1}),l(H,{label:"节目单",name:"programs"},{label:o(()=>[...e[18]||(e[18]=[v("span",null,"节目单",-1)])]),_:1})]),_:1},8,["modelValue"]),g.value==="platforms"?(_(),h("div",Me,[v("div",Ee,[l(f,{type:"primary",onClick:ne},{default:o(()=>[l(Y,null,{default:o(()=>[l(O)]),_:1}),e[19]||(e[19]=m(" 新建平台 ",-1))]),_:1})]),v("div",Re,[X((_(),R(L,{data:F.value},{default:o(()=>[l(u,{prop:"name",label:"平台名称","min-width":"150"}),l(u,{prop:"airDate",label:"播出日期",width:"120"}),l(u,{prop:"airTime",label:"播出时间",width:"100"}),l(u,{prop:"channel",label:"播出频道",width:"150"}),l(u,{prop:"reviewStatus",label:"审核状态",width:"100"},{default:o(({row:a})=>[l(q,{type:G[a.reviewStatus],size:"small"},{default:o(()=>[m(Z(I[a.reviewStatus]),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"sort",label:"排序",width:"80"}),l(u,{label:"操作",width:"200",fixed:"right"},{default:o(({row:a})=>[l(f,{size:"small",onClick:E=>se(a)},{default:o(()=>[...e[20]||(e[20]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:E=>de(a)},{default:o(()=>[...e[21]||(e[21]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,w.value]])])])):(_(),h("div",Ie,[v("div",Ge,[v("div",He,[e[22]||(e[22]=v("label",null,"选择平台",-1)),l(be,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=a=>V.value=a),placeholder:"请选择平台",onChange:M,style:{width:"200px"}},{default:o(()=>[(_(!0),h(ke,null,Te(ae.value,a=>(_(),R(_e,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),V.value?(_(),h("div",Oe,[l(f,{type:"primary",onClick:me},{default:o(()=>[l(Y,null,{default:o(()=>[l(O)]),_:1}),e[23]||(e[23]=m(" 新建节目 ",-1))]),_:1})])):Pe("",!0),v("div",Ye,[X((_(),R(L,{data:$.value},{default:o(()=>[l(u,{prop:"orderNum",label:"序号",width:"80"}),l(u,{prop:"title",label:"节目名称","min-width":"200"}),l(u,{prop:"type",label:"类型",width:"120"}),l(u,{prop:"performers",label:"表演者","min-width":"200","show-overflow-tooltip":""}),l(u,{prop:"airTime",label:"播出时间",width:"100"}),l(u,{prop:"reviewStatus",label:"审核状态",width:"100"},{default:o(({row:a})=>[l(q,{type:G[a.reviewStatus],size:"small"},{default:o(()=>[m(Z(I[a.reviewStatus]),1)]),_:2},1032,["type"])]),_:1}),l(u,{label:"操作",width:"200",fixed:"right"},{default:o(({row:a})=>[l(f,{size:"small",onClick:E=>pe(a)},{default:o(()=>[...e[24]||(e[24]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:E=>ve(a)},{default:o(()=>[...e[25]||(e[25]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,w.value]])])])),l(Q,{modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=a=>P.value=a),title:N.value,width:"600px",onClosed:ue},{footer:o(()=>[l(f,{onClick:e[8]||(e[8]=a=>P.value=!1)},{default:o(()=>[...e[26]||(e[26]=[m("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:ie,loading:B.value},{default:o(()=>[...e[27]||(e[27]=[m(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(K,{ref_key:"platformFormRef",ref:x,model:r,rules:te,"label-width":"100px"},{default:o(()=>[l(p,{label:"平台名称",prop:"name"},{default:o(()=>[l(k,{modelValue:r.name,"onUpdate:modelValue":e[2]||(e[2]=a=>r.name=a),placeholder:"如：央视春晚、河南春晚等"},null,8,["modelValue"])]),_:1}),l(p,{label:"播出日期",prop:"airDate"},{default:o(()=>[l(ye,{modelValue:r.airDate,"onUpdate:modelValue":e[3]||(e[3]=a=>r.airDate=a),type:"date",placeholder:"选择播出日期",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(p,{label:"播出时间"},{default:o(()=>[l(A,{modelValue:r.airTime,"onUpdate:modelValue":e[4]||(e[4]=a=>r.airTime=a),placeholder:"选择播出时间",style:{width:"100%"},"value-format":"HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(p,{label:"播出频道"},{default:o(()=>[l(k,{modelValue:r.channel,"onUpdate:modelValue":e[5]||(e[5]=a=>r.channel=a),placeholder:"如：CCTV-1、河南卫视等"},null,8,["modelValue"])]),_:1}),l(p,{label:"描述"},{default:o(()=>[l(k,{modelValue:r.description,"onUpdate:modelValue":e[6]||(e[6]=a=>r.description=a),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),l(p,{label:"排序"},{default:o(()=>[l(J,{modelValue:r.sort,"onUpdate:modelValue":e[7]||(e[7]=a=>r.sort=a),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(Q,{modelValue:C.value,"onUpdate:modelValue":e[16]||(e[16]=a=>C.value=a),title:j.value,width:"600px",onClosed:ce},{footer:o(()=>[l(f,{onClick:e[15]||(e[15]=a=>C.value=!1)},{default:o(()=>[...e[28]||(e[28]=[m("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:fe,loading:z.value},{default:o(()=>[...e[29]||(e[29]=[m(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(K,{ref_key:"programFormRef",ref:S,model:i,rules:oe,"label-width":"100px"},{default:o(()=>[l(p,{label:"节目名称",prop:"title"},{default:o(()=>[l(k,{modelValue:i.title,"onUpdate:modelValue":e[10]||(e[10]=a=>i.title=a),placeholder:"请输入节目名称"},null,8,["modelValue"])]),_:1}),l(p,{label:"节目类型"},{default:o(()=>[l(k,{modelValue:i.type,"onUpdate:modelValue":e[11]||(e[11]=a=>i.type=a),placeholder:"如：歌舞、小品、相声等"},null,8,["modelValue"])]),_:1}),l(p,{label:"表演者"},{default:o(()=>[l(k,{modelValue:i.performers,"onUpdate:modelValue":e[12]||(e[12]=a=>i.performers=a),placeholder:"请输入表演者，多个用逗号分隔"},null,8,["modelValue"])]),_:1}),l(p,{label:"播出时间"},{default:o(()=>[l(A,{modelValue:i.airTime,"onUpdate:modelValue":e[13]||(e[13]=a=>i.airTime=a),placeholder:"选择播出时间",style:{width:"100%"},"value-format":"HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(p,{label:"节目序号"},{default:o(()=>[l(J,{modelValue:i.orderNum,"onUpdate:modelValue":e[14]||(e[14]=a=>i.orderNum=a),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ke=he(qe,[["__scopeId","data-v-7fae1189"]]);export{Ke as default};
